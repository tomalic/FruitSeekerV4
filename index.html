<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FruitSeeker</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#ffffff" />
  <style>
    :root { --bg:#ffffff; --card:#ffffff; --muted:#475569; --text:#0f172a; --accent:#2563eb; --accent-2:#60a5fa; --danger:#ef4444; --border:#e5e7eb; --shadow: 0 8px 28px rgba(15,23,42,.08); }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial; background:var(--bg); color:var(--text);}
    header{ position:sticky; top:0; z-index:5; background:rgba(255,255,255,0.9); backdrop-filter: blur(6px); border-bottom:1px solid var(--border); }
    .wrap{max-width:1120px; margin:0 auto; padding:16px;}
    .title{display:flex; gap:14px; align-items:center}
    .logo{width:56px; height:56px; border-radius:14px; background:#fff url(assets/icon-192.png) center/cover no-repeat; border:1px solid var(--border); flex:0 0 auto;}
    h1{font-size:28px; margin:0; letter-spacing:.2px}
    .spacer{flex:1}
    .badge{display:inline-block; border:1px solid var(--border); padding:6px 12px; border-radius:999px; font-size:12px; color:#058b35; background:#ecfdf5}
    main .wrap{display:grid; gap:18px; padding-top:18px; padding-bottom:60px;}
    .card{ background:var(--card); border:1px solid var(--border); border-radius:18px; padding:18px; box-shadow: var(--shadow); }
    .uploadBox{ display:flex; align-items:center; justify-content:flex-start; flex-wrap:wrap; gap:12px; }
    .btn{ appearance:none; border:none; border-radius:12px; padding:12px 18px; color:#fff; background:var(--accent); font-weight:700; cursor:pointer; box-shadow: 0 6px 18px rgba(37,99,235,.25); }
    .btn.warn{background:var(--danger); color:#fff; box-shadow:none}
    input[type="file"]{display:none}
    .pill{display:inline-block; padding:8px 12px; border-radius:999px; background:#f8fafc; border:1px solid var(--border); font-size:12px; color:var(--muted)}
    .grid{display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));}
    label{font-size:13px; color:var(--muted);}
    select, input[type="text"]{ width:100%; background:#fff; color:#0f172a; border:1px solid var(--border); border-radius:12px; padding:10px 12px; outline:none; }
    select:focus, input[type="text"]:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    table{width:100%; border-collapse:collapse; font-size:14px; background:#fff;}
    th, td{border-bottom:1px solid var(--border); padding:10px; text-align:left;}
    th{user-select:none; cursor:pointer;}
    .status{font-size:12px; color:var(--muted);}
    .hidden{display:none}
    .toast{position:fixed; bottom:16px; right:16px; background:#0f172a; border:1px solid #0b1220; padding:10px 12px; border-radius:12px; color:#fff; font-size:13px; opacity:0; transform:translateY(12px); transition: all .25s ease;}
    .toast.show{opacity:1; transform:translateY(0)}
  </style>
</head>
<body>
<header>
  <div class="wrap title">
    <div class="logo" aria-hidden="true"></div>
    <h1>FruitSeeker</h1>
    <div class="spacer"></div>
    <div id="offlineBadge" class="badge">Estado: <span id="netState">online</span></div>
  </div>
</header>

<main>
  <div class="wrap">
    <section class="card">
      <div class="uploadBox">
        <label for="filePick" class="btn">Selecciona archivo</label>
        <input id="filePick" type="file" accept=".csv,.xlsx,.xls" />
        <div class="pill">Datos guardados: <span id="count">0</span> filas</div>
        <button id="clearBtn" class="btn warn">Borrar datos</button>
      </div>
      <div id="xlsxBanner" class="status hidden" style="margin-top:6px">Para Excel offline, añade <code>lib/xlsx.full.min.js</code> al proyecto o usa CSV.</div>

      <div id="mapBox" class="grid hidden" style="margin-top:14px">
        <div>
          <label>Part number</label>
          <select id="mapPart"></select>
        </div>
        <div>
          <label>EAN</label>
          <select id="mapEan"></select>
        </div>
        <div>
          <label>Description</label>
          <select id="mapDesc"></select>
        </div>
        <div>
          <label>Precio</label>
          <select id="mapPrice"></select>
        </div>
        <div style="grid-column:1/-1; display:flex; gap:8px; flex-wrap:wrap">
          <button id="saveBtn" class="btn">Guardar en este dispositivo</button>
          <button id="cancelMap" class="btn" style="background:#64748b">Cancelar</button>
          <div id="mapStatus" class="status" style="align-self:center"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="grid" style="align-items:end">
        <div style="grid-column:1/-1">
          <label for="q">Buscar (cualquier dato)</label>
          <input id="q" type="text" placeholder="Escribe parte del part number, EAN, descripción o precio…" autocomplete="off" />
        </div>
      </div>
      <div class="status" style="margin-top:8px">
        <span>Resultados: <span id="resultCount">0</span></span>
        <span id="searchInfo" class="muted"></span>
      </div>
      <div style="overflow:auto; margin-top:8px">
        <table id="tbl">
          <thead>
            <tr>
              <th data-k="partNumber">Part number</th>
              <th data-k="ean">EAN</th>
              <th data-k="description">Description</th>
              <th data-k="price">Precio</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="emptyState" class="status hidden" style="padding:12px">No se han encontrado resultados.</div>
      </div>
    </section>
  </div>
</main>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script type="module" src="js/app.js"></script>
</body>
</html>
